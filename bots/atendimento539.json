{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"0baa7a0b-717f-41af-b795-7a89def6c073","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"0989c41a-9fab-4382-824f-6bdb9cef2f5e","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"f50ed6c2-d869-4ad1-bc02-1bef8b7d34d7","type":"ExecuteScript","$title":"negrito","$invalid":false,"settings":{"function":"run","source":"function run() {\n    let negrito = { 'inicio': '', 'fim': '' };\n    try {\n        var resource = \"{{contact.source}}\";\n        switch (resource) {\n            case 'WhatsApp':\n                return { 'inicio': '*', 'fim': '*' };\n            case '0mn.io':\n                return { 'inicio': '<b>', 'fim': '</b>' };\n            default:\n                return negrito;\n        }\n    }\n    catch (ex) {\n        return negrito;\n    }\n}","inputVariables":[],"outputVariable":"negrito"},"conditions":[]},{"$id":"6d60e39b-fd42-4490-8067-abb899a477c4","type":"ExecuteScript","$title":"italico","$invalid":false,"settings":{"function":"run","source":"function run() {\n    let italico = { 'inicio': '', 'fim': '' };\n    try {\n        var resource = \"{{contact.source}}\";\n        switch (resource) {\n            case 'WhatsApp':\n                return { 'inicio': '_', 'fim': '_' };\n            case '0mn.io':\n                return { 'inicio': '<i>', 'fim': '</i>' };\n            default:\n                return italico;\n        }\n    }\n    catch (ex) {\n        return italico;\n    }\n}","inputVariables":[],"outputVariable":"italico"},"conditions":[]},{"$id":"9cbc8831-af85-4ec2-aea2-683cbeed441c","type":"SetVariable","$title":"Definir Setor","$invalid":false,"settings":{"variable":"setor","value":"tecnico"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#2cc3d5","label":"vari√°vel","id":"blip-tag-6f6eb328-7344-e437-52c7-95a250395bd9","canChangeBackground":false},{"background":"#FF4A1E","label":"script","id":"blip-tag-c9aeb0ae-5695-699e-c13a-f932074c9608","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"In√≠cio","$position":{"top":"39px","left":"397px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"d797dd0e-155c-413d-89e9-0cfd32f35464","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"db695d91-72d6-496c-9e26-d396d617afd7","conditions":[{"source":"context","comparison":"equals","values":["Valida hor√°rio de atendimento"],"variable":"state.name"}],"$id":"88bbecdd-88d3-43f2-a664-d9253f90588d","$connId":"con_8","$invalid":false},{"stateId":"error","$connId":"con_13","$id":"e6846d62-5fde-4d82-9757-6de4041997fd","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[],"id":"fallback","$title":"Exce√ß√µes","$position":{"top":"44px","left":"679px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"$id":"e7e808e3-8367-448b-8af8-d6fc011c3bb3","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000000","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"action":{"$id":"75b94ae2-885e-4059-a5b8-0058c84fd396","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Seja bem vindo ao atendimentoüòÄ!","metadata":{}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000001","type":"text/plain","content":"Seja bem vindo ao atendimentoüòÄ!"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c9a0e495-ea25-49c5-aa4e-106aaf7eb291","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ad617488-1b04-447f-bc70-fe550294312b","$connId":"con_18","$id":"11c98d34-8cd6-4824-ae05-15b50f9f9315","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"welcome","$title":"Boas vindas","$position":{"top":"173px","left":"397px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"action":{"$id":"c705dae3-00aa-4254-a49a-ada4657da70c","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"action":{"$id":"07fb895d-9f08-46f7-99b4-4053926607f0","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, n√£o consegui entender!"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, n√£o consegui entender!"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"c3efc640-817c-4aae-affa-c1ada8f9dc48","type":"text/plain","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[],"id":"error","$title":"Erro padr√£o","$position":{"top":"43px","left":"1061px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3367d654-ced2-4208-8973-6f8d681980eb":{"$contentActions":[{"action":{"$id":"9c077ba3-71a9-4cd2-8e22-8cc9277702f6","type":"SendMessage","settings":{"id":"ab6b9287-69eb-43fa-8126-02d35e46f4dc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ab6b9287-69eb-43fa-8126-02d35e46f4dc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"23f95cc5-efe4-4be9-89a7-08eb3efc4380","type":"SendMessage","settings":{"id":"02810fa7-f227-4186-83e7-a93c14756c16","type":"text/plain","content":"Para come√ßar, voc√™ pode me detalhar o que est√° ocorrendo?","metadata":{}},"$cardContent":{"document":{"id":"02810fa7-f227-4186-83e7-a93c14756c16","type":"text/plain","content":"Para come√ßar, voc√™ pode me detalhar o que est√° ocorrendo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"9829d65d-8d9d-4b76-a701-415fff48e087","type":"text/plain","textContent":"Entrada do usu√°rio","content":"motivo"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"motivo"},"$invalid":false},{"action":{"$id":"16c8440d-2390-4490-a117-f614c7115766","type":"SendMessage","settings":{"id":"3e726c86-658a-4846-afc7-de33c86e8389","type":"text/plain","content":"Entendido!","metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"3e726c86-658a-4846-afc7-de33c86e8389","type":"text/plain","content":"Entendido!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ff3adb44-abef-43f7-bad4-546d376e192c","type":"SendMessage","settings":{"id":"bf5d0000-b67c-451b-8fa0-7e8602ea2dee","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000},"metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"bf5d0000-b67c-451b-8fa0-7e8602ea2dee","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"fe6bafba-8d2f-461f-ac7e-07453d9bc717","type":"SendMessage","settings":{"id":"92181fe6-2ddd-459c-90c2-e5727c88ad11","type":"text/plain","content":"Aguarde um instante, que irei lhe redirecionar para o atendimento humano!","metadata":{"#stateName":"{{state.name}}","#stateId":"{{state.id}}","#messageId":"{{input.message@id}}","#previousStateId":"{{state.previous.id}}","#previousStateName":"{{state.previous.name}}"}},"$cardContent":{"document":{"id":"92181fe6-2ddd-459c-90c2-e5727c88ad11","type":"text/plain","content":"Aguarde um instante, que irei lhe redirecionar para o atendimento humano!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"103667a2-1f7c-4669-82ab-8594c7c7adfa","$connId":"con_23","$id":"3a3c9a8f-6aee-4cf6-aed4-f08133e201b6","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"71570400-aa8f-482a-9848-b5045f8a4a22","type":"TrackEvent","$title":"Assuntos Problemas T√©cnicos","$invalid":false,"settings":{"extras":{},"category":"Assuntos Problemas T√©cnicos","action":"{{motivo}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#61D36F","label":"entrada","id":"blip-tag-c2fef3ca-76b2-b3ff-9e13-a1e7af356ac2","canChangeBackground":false}],"id":"3367d654-ced2-4208-8973-6f8d681980eb","root":false,"$title":"Obter motivo do contato","$position":{"top":"373px","left":"444px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"103667a2-1f7c-4669-82ab-8594c7c7adfa":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b292f4e6-f209-4a49-87c5-35ef60d60e04","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fallback","$connId":"con_28","$id":"474a1e7a-f54b-445f-a3cd-a3d6ff673e23","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"disponibilidade@disponivel"}],"$invalid":false},{"stateId":"desk:77908135-12e5-4f89-a802-882a6d720619","$connId":"con_33","$id":"4a56d9de-ef02-4da4-a665-7eec056e808d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"1d02a6b7-324a-44b1-9f83-af0ffa5888fe","type":"ExecuteScript","$title":"Validar hor√°rio de atendimento","$invalid":false,"settings":{"function":"run","source":"var hoje = new Date();\nvar hora = hoje.getHours() - 3;\nvar minutos = hoje.getMinutes();\nvar semana = ['dom', 'seg', 'ter', 'qua', 'qui', 'sex', 'sab'];\nvar diaSemana = semana[hoje.getDay()];\nvar mes = hoje.getMonth() + 1;\nvar diaMes = hoje.getDate();\nvar disponibilidade = {disponivel: \"\", setor: \"\"};\n\n// para adicionar ou remover feriado, basta editar o valor da vari√°vel abaixo sendo, dia (com dois d√≠gitos) e o m√™s (com dois d√≠gitos somente √† partir de Outubro (10))\n// para adicionar o feriado de Tiradentes (21/4): var feriados = ['01/1','25/12','21/4'];\n// para remover o feriado de ano novo (01/1): var feriados = ['25/12'];\n//'01/1'- Confraterniza√ß√£o Universal (Ano Novo)\n//'30/3'- Paix√£o de Cristo\n//'21/4'- Tiradentes\n//'01/5'- Dia do Trabalho\n//'31/5'- Corpus Christi\n//'07/9'- Independ√™ncia do Brasil\n//'12/10'- Nossa Sra Aparecida - Padroeira do Brasil\n//'02/11'- Finados\n//'15/11'- Proclama√ß√£o da Rep√∫blica\n//'25/12'- Natal\n// Os feriados acima remetem as datas nacionais.\nvar feriados = ['01/1', '30/3', '21/4', '01/5', '31/5', '07/9', '12/10', '02/11', '15/11', '25/12'];\n\nfunction plantao() {\n\n    disponibilidade[\"setor\"] = \"plantao\";\n    disponibilidade[\"disponivel\"] = true;\n\n    if (feriados.indexOf(diaMes + '/' + mes) != -1) {\n        disponibilidade[\"disponivel\"] = false;\n        return disponibilidade;\n    }\n    if (diaSemana !== 'sab') {\n        disponibilidade[\"disponivel\"] = false;\n        return disponibilidade;\n    }\n    if (hora < 9 || hora >= 13) {\n        disponibilidade[\"disponivel\"] = false;\n        return disponibilidade;\n    }\n    return disponibilidade;\n}\n\nfunction tecnico() {\n\n    disponibilidade[\"setor\"] = \"tecnico\";\n    disponibilidade[\"disponivel\"] = true;\n\n    if (feriados.indexOf(diaMes + '/' + mes) != -1) {\n        disponibilidade[\"disponivel\"] = false;\n        return disponibilidade;\n    }\n    if (diaSemana === 'dom' || diaSemana === 'sab') {\n        disponibilidade[\"disponivel\"] = false;\n        return disponibilidade;\n    }\n    if (hora < 8 || hora > 17) {\n        disponibilidade[\"disponivel\"] = false;\n        return disponibilidade;\n    }\n    return disponibilidade;\n}\n\n\nfunction run(setor) {\n    var disponibilidade;\n    \n    disponibilidade = setor.toLowerCase() + '()';\n    \n    var execute = eval(disponibilidade);\n\n    if(execute[\"disponivel\"] == false){\n         execute = plantao();\n    }\n\n    return execute;\n}","inputVariables":["setor"],"outputVariable":"disponibilidade","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"4576dd69-270c-42f0-b6a0-f4b557acdfce","type":"MergeContact","$title":"Definir Atendimento","$invalid":false,"settings":{"extras":{"motivo":"{{motivo}}","setor":"{{disponibilidade@setor}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#FF4A1E","label":"script","id":"blip-tag-c9aeb0ae-5695-699e-c13a-f932074c9608","canChangeBackground":false},{"background":"#2cc3d5","label":"vari√°vel","id":"blip-tag-6f6eb328-7344-e437-52c7-95a250395bd9","canChangeBackground":false},{"background":"#FF1E90","label":"definir um contato","id":"blip-tag-9b19dae4-cba8-cd3f-8e89-439b9cc073ac","canChangeBackground":false}],"id":"103667a2-1f7c-4669-82ab-8594c7c7adfa","root":false,"$title":"Valida hor√°rio de atendimento","$position":{"top":"471px","left":"677px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"db695d91-72d6-496c-9e26-d396d617afd7":{"$contentActions":[{"action":{"$id":"2f9f6674-8885-484e-a963-2f140c61f704","type":"SendMessage","settings":{"id":"e8c4699d-7da8-40bc-bc1a-c4c1a580c723","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e8c4699d-7da8-40bc-bc1a-c4c1a580c723","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2c341b2b-3ec7-4c18-87df-d2cc1d4e6a41","type":"SendMessage","settings":{"id":"d219fc27-21e5-4ff3-bc64-8d6b038fd0b1","type":"text/plain","content":"Desculpe, nosso hor√°rio de atendimento √© de 8hrs √†s 18hrs de segunda √† sexta e aos s√°bados de 9hrs √†s 13hrs!","metadata":{}},"$cardContent":{"document":{"id":"d219fc27-21e5-4ff3-bc64-8d6b038fd0b1","type":"text/plain","content":"Desculpe, nosso hor√°rio de atendimento √© de 8hrs √†s 18hrs de segunda √† sexta e aos s√°bados de 9hrs √†s 13hrs!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"baaa6a9b-54d3-4837-8dc9-656e07db0ddb","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[],"id":"db695d91-72d6-496c-9e26-d396d617afd7","root":false,"$title":"Horario Indisponivel","$position":{"top":"167px","left":"963px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"desk:77908135-12e5-4f89-a802-882a6d720619":{"$contentActions":[{"input":{"bypass":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"equals","values":["true"]}],"$cardContent":{"document":{"id":"ec3a1fe9-e265-4ff7-9922-833b74eaf046","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant"]}],"$invalid":false,"stateId":"6cceb009-c28f-4211-a7ca-5ebc073102dc","$connId":"con_38","$id":"ee4940f8-22e8-4415-b7c3-0f13cd003daa"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClient"]}],"$invalid":false,"stateId":"6cceb009-c28f-4211-a7ca-5ebc073102dc","$connId":"con_43","$id":"c48b8ba6-4ade-4309-8c85-598ec1dd63c7"}],"$enteringCustomActions":[{"$id":"650873af-2e2f-4c14-9997-fbf9d0fbe2a2","type":"ExecuteScript","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:77908135-12e5-4f89-a802-882a6d720619"]},{"source":"context","variable":"tunnel.identity","comparison":"exists","values":[]}],"settings":{"function":"run","source":"function run(contact, tunnel_identity) {\n    contact = JSON.parse(contact);\n    contact.identity = tunnel_identity;\n    return contact;\n}","inputVariables":["contact.serialized","tunnel.identity"],"outputVariable":"deskUpdateTunnelContactBody","LocalTimeZoneEnabled":false}},{"$id":"9e218c0d-ed38-4036-be21-12065360f4ec","type":"ProcessCommand","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:77908135-12e5-4f89-a802-882a6d720619"]},{"source":"context","variable":"tunnel.identity","comparison":"exists","values":[]}],"settings":{"to":"postmaster@msging.net","from":"{{application.identity}}","method":"merge","uri":"/contacts","type":"application/vnd.lime.contact+json","resource":"{{deskUpdateTunnelContactBody}}","variable":"mergeRouterContactWithTunnelCommandResponse"}},{"$id":"827490bf-b61b-4c37-b91d-3ad9cbbf12db","type":"ExecuteScript","$title":"GetEncodedContactIdentity","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:77908135-12e5-4f89-a802-882a6d720619"]}],"settings":{"function":"run","source":"function run(identity) {\n return (identity !== undefined) ? encodeURIComponent(identity) : identity;\n}","inputVariables":["input.message.fromidentity"],"outputVariable":"helpDeskEncodedFromIdentity","LocalTimeZoneEnabled":false}},{"$id":"d5e9ab33-81c3-42a9-886f-5e63f04cd22a","type":"ProcessCommand","$title":"GetOpenTicket","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:77908135-12e5-4f89-a802-882a6d720619"]}],"settings":{"from":"{{application.identifier}}@{{application.domain}}","to":"postmaster@desk.msging.net","method":"get","uri":"/tickets?$filter=customerIdentity%20eq%20%27{{helpDeskEncodedFromIdentity}}%27%20and%20%28status%20eq%20%27Open%27%20or%20status%20eq%20%27Waiting%27%20or%20status%20eq%20%27Assigned%27%29","metadata":{"server.shouldStore":true},"variable":"helpDeskGetOpenTicketCommandResponse"}},{"$id":"56153d0a-02ee-4efc-a567-25f20f2322c2","type":"ExecuteScript","$title":"TreatGetOpenTicketResponse","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:77908135-12e5-4f89-a802-882a6d720619"]}],"settings":{"function":"run","source":"function run(commandResponse) {\n    var response = JSON.parse(commandResponse)\n    var ticketExists = (response && response.resource && response.resource.items && response.resource.items.length > 0);\n  return ticketExists ? \"true\" : \"false\";\n}","inputVariables":["helpDeskGetOpenTicketCommandResponse"],"outputVariable":"helpDeskHasTicket","LocalTimeZoneEnabled":false}},{"$id":"460b9e5d-5362-46a2-96b5-a924ecb5acb5","type":"ProcessCommand","$title":"OpenTicketIfNotFound","$invalid":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"notEquals","values":["true"]}],"settings":{"from":"{{application.identifier}}@{{application.domain}}","to":"postmaster@desk.msging.net","method":"set","uri":"/tickets/{{helpDeskEncodedFromIdentity}}","variable":"helpDeskOpenTicketCommandResponse","type":"text/plain","resource":"{{input.content}}","metadata":{"server.shouldStore":true}}},{"$id":"5fa2bd09-ef44-429b-9c26-f30a65522fd2","type":"ExecuteScript","$title":"TreatOpenTicketResponse","$invalid":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"notEquals","values":["true"]}],"settings":{"function":"run","source":"function run(commandResponse) {\n    var response = commandResponse ? JSON.parse(commandResponse) : {}\n    var ticketExists = response && response.type === \"application/vnd.iris.ticket+json\" && response.resource \n    return ticketExists ? \"true\" : \"false\";\n}","inputVariables":["helpDeskOpenTicketCommandResponse"],"outputVariable":"helpDeskHasTicket","LocalTimeZoneEnabled":false}},{"$id":"a458fad4-e2c7-4b9c-8644-80a5277fbb13","type":"ForwardMessageToDesk","conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"equals","values":["true"]}],"settings":{},"$invalid":false}],"$leavingCustomActions":[{"$id":"5cac22fa-d468-42f4-80a4-7c0bf5228ecc","type":"SetVariable","$title":"ResetHasTicket","$invalid":false,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant","ClosedClient"]}],"settings":{"variable":"helpDeskHasTicket","value":"false","$invalid":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:77908135-12e5-4f89-a802-882a6d720619","$invalid":false},"$tags":[],"id":"desk:77908135-12e5-4f89-a802-882a6d720619","deskStateVersion":"1.0.0","root":false,"$title":"Atendimento humano","$position":{"top":"651px","left":"440px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6cceb009-c28f-4211-a7ca-5ebc073102dc":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"ae22ed77-2218-4490-be4b-74a62e769983","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"9b78f2c1-294f-4942-b8ee-5871c4fae54d","type":"Redirect","$title":"Redirecionar a para NPS","$invalid":false,"settings":{"context":{"type":"text/plain","value":"oi"},"address":"NPS"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"6cceb009-c28f-4211-a7ca-5ebc073102dc","root":false,"$title":"Redirecionar para NPS","$position":{"top":"490px","left":"269px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"ad617488-1b04-447f-bc70-fe550294312b":{"$contentActions":[{"action":{"$id":"72ddfb25-39fe-47c6-a017-2c3e32ec7e09","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"9a5eeff5-4b8e-4432-a047-db6cc05a0280","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"9a5eeff5-4b8e-4432-a047-db6cc05a0280","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"63ce0b83-73ac-47ee-9ee7-f53d931262f2","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c77d3b29-73a9-45d3-b028-ae038c166383","type":"text/plain","content":"Para come√ßar digite o seu nome","metadata":{}},"$cardContent":{"document":{"id":"c77d3b29-73a9-45d3-b028-ae038c166383","type":"text/plain","content":"Para come√ßar digite o seu nome"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"24ddc2ed-a2a2-4efb-bdd8-21c299094bd3","type":"text/plain","textContent":"Entrada do usu√°rio","content":"Entrada do usu√°rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"3367d654-ced2-4208-8973-6f8d681980eb","$connId":"con_48","$id":"2fe0f3a1-6ac9-47cf-9df8-cce718ecc649","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"59aa2fb0-dfdd-4c2c-9cf5-cc57407ced63","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{},"name":"{{input.content}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"ad617488-1b04-447f-bc70-fe550294312b","root":false,"$title":"Obter nome","$position":{"top":"265px","left":"417px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"globalAction":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback"},"$tags":[],"id":"global-actions"}}